{% extends "base.html" %}
{% load static %}

{% block title %}My Profile{% endblock %}

{% block content %}
<div class="container">

  <h1 class="mb-4">My Profile</h1>
  <div class="row"> 
    <div class="col-md-2">
      <!-- Profile Picture -->
      {% if request.user.profile_image %}
        <img src="{{ request.user.profile_image.url }}"
            alt="profile picture"
            class="rounded-circle border"
            style="width:120px; height:120px; object-fit:cover; margin-bottom:20px;">
      {% else %}
        <img src="{% static 'default_profile.png' %}"
            alt="default profile"
            class="rounded-circle border"
            style="width:120px; height:120px; object-fit:cover; margin-bottom:20px;">
      {% endif %}
    </div>
    <div class="col-md-2">
      <div class="container rounded text-white bg-secondary"  style="width: fit-content;">
        <p><strong>Username:</strong> {{ request.user.username }}</p>
        <p><strong>Email:</strong> {{ request.user.email }}</p>
        <p><strong>First name:</strong> {{ request.user.first_name }}</p>
        <p><strong>Last name:</strong> {{ request.user.last_name }}</p>
        <p><strong>Favorite Genre:</strong> {{ request.user.favorite_genre|title }}</p>
      </div>
    </div>
  
    <div class="col-md-3">
      <div class="container rounded text-white bg-secondary p-4" style="width: fit-content;">
        <p><strong>Favorite Authors:</strong>
          {% if request.user.favorite_authors %}
            {{ request.user.favorite_authors|join:", " }}
          {% else %}
            <em>No authors listed</em>
          {% endif %}
        </p>

        <p><strong>Bio:</strong><br>
          {{ request.user.user_bio|linebreaks }}
        </p>

        <a href="{% url 'accounts:profile_edit' %}" class="btn btn-primary me-2">Edit Profile</a>
        <a href="{% url 'accounts:password_change' %}" class="btn btn-outline-primary">Change Password</a>
      </div>
    </div>
  </div>
</div>


<br>
<h2>Your Books</h2>
{% if owned_books %}
  <div class="row">
    {% for book in owned_books %}
      <div class="col-md-3">
        <div class="card mb-3">
          <img src="{{ book.product_images.0 }}" class="card-img-top">
          <div class="card-body">
            <h5 class="card-title">{{ book.product_name }}</h5>
            <p class="card-text">{{ book.product_description|truncatechars:80 }}</p>
            <a href="{% url 'products:product_details' book.pk %}" class="btn btn-primary">View</a>
          </div>
        </div>
      </div>
    {% endfor %}
  </div>
{% else %}
  <p>You dont own any books yet.</p>
{% endif %}


{% endblock %}
